use crate::base::defs::GlobalMap;
use std::collections::HashMap;
use std::str;
use once_cell::sync::Lazy;

// Global static variable for diagonal_map
pub static DIAGONAL_MAP: Lazy<HashMap<u128, u64>> = Lazy::new(|| {
    let json_str = str
        ::from_utf8(include_bytes!("./diagonalMap.json"))
        .expect("Invalid UTF-8 in diagonalMap.json");

    serde_json::from_str(json_str).expect("Failed to deserialize diagonalMap.json")
});

// Global static variable for diagonal_map
pub static STRAIGHT_MAP: Lazy<HashMap<u128, u64>> = Lazy::new(|| {
    let json_str = str
        ::from_utf8(include_bytes!("./straightMap.json"))
        .expect("Invalid UTF-8 in diagonalMap.json");

    serde_json::from_str(json_str).expect("Failed to deserialize straightMap.json")
});

impl GlobalMap {
    pub fn diagonal_map(index: u8, opp_bit_map: u64) -> u64 {
        let mut hash: u128 = (opp_bit_map as u128) << 6;
        hash |= index as u128;
        *DIAGONAL_MAP.get(&hash).unwrap()
    }

    pub fn straight_map(index: u8, opp_bit_map: u64) -> u64 {
        let mut hash: u128 = (opp_bit_map as u128) << 6;
        hash |= index as u128;
        *STRAIGHT_MAP.get(&hash).unwrap()
    }

    /// **Forces full initialization at startup**
    pub fn init() {
        Lazy::force(&DIAGONAL_MAP);
        Lazy::force(&STRAIGHT_MAP);
    }

    // NOTE: All these assume that Index 0 === a1 ( Top-Left of the board )
    pub const PAWN_TABLE: [[i32; 8]; 8] = [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [5, 10, 10, -20, -20, 10, 10, 5],
        [5, -5, -10, 0, 0, -10, -5, 5],
        [0, 0, 0, 20, 20, 0, 0, 0],
        [5, 5, 10, 25, 25, 10, 5, 5],
        [10, 10, 20, 30, 30, 20, 10, 10],
        [50, 50, 50, 50, 50, 50, 50, 50],
        [0, 0, 0, 0, 0, 0, 0, 0],
    ];

    pub const KNIGHT_TABLE: [[i32; 8]; 8] = [
        [-50, -40, -30, -30, -30, -30, -40, -50],
        [-40, -20, 0, 5, 5, 0, -20, -40],
        [-30, 5, 10, 15, 15, 10, 5, -30],
        [-30, 0, 15, 20, 20, 15, 0, -30],
        [-30, 5, 15, 20, 20, 15, 5, -30],
        [-30, 0, 10, 15, 15, 10, 0, -30],
        [-40, -20, 0, 0, 0, 0, -20, -40],
        [-50, -40, -30, -30, -30, -30, -40, -50],
    ];

    pub const BISHOP_TABLE: [[i32; 8]; 8] = [
        [-20, -10, -10, -10, -10, -10, -10, -20],
        [-10, 5, 0, 0, 0, 0, 5, -10],
        [-10, 10, 10, 10, 10, 10, 10, -10],
        [-10, 0, 10, 10, 10, 10, 0, -10],
        [-10, 5, 5, 10, 10, 5, 5, -10],
        [-10, 0, 5, 10, 10, 5, 0, -10],
        [-10, 0, 0, 0, 0, 0, 0, -10],
        [-20, -10, -10, -10, -10, -10, -10, -20],
    ];

    pub const ROOK_TABLE: [[i32; 8]; 8] = [
        [0, 0, 0, 5, 5, 0, 0, 0],
        [-5, 0, 0, 0, 0, 0, 0, -5],
        [-5, 0, 0, 0, 0, 0, 0, -5],
        [-5, 0, 0, 0, 0, 0, 0, -5],
        [-5, 0, 0, 0, 0, 0, 0, -5],
        [-5, 0, 0, 0, 0, 0, 0, -5],
        [5, 10, 10, 10, 10, 10, 10, 5],
        [0, 0, 0, 0, 0, 0, 0, 0],
    ];

    pub const QUEEN_TABLE: [[i32; 8]; 8] = [
        [-20, -10, -10, -5, -5, -10, -10, -20],
        [-10, 0, 5, 0, 0, 0, 0, -10],
        [-10, 5, 5, 5, 5, 5, 0, -10],
        [0, 0, 5, 5, 5, 5, 0, -5],
        [-5, 0, 5, 5, 5, 5, 0, -5],
        [-10, 0, 5, 5, 5, 5, 0, -10],
        [-10, 0, 0, 0, 0, 0, 0, -10],
        [-20, -10, -10, -5, -5, -10, -10, -20],
    ];

    pub const KING_TABLE_START: [[i32; 8]; 8] = [
        [20, 30, 10, 0, 0, 10, 30, 20],
        [20, 20, 0, 0, 0, 0, 20, 20],
        [-10, -20, -20, -20, -20, -20, -20, -10],
        [-20, -30, -30, -40, -40, -30, -30, -20],
        [-30, -40, -40, -50, -50, -40, -40, -30],
        [-30, -40, -40, -50, -50, -40, -40, -30],
        [-30, -40, -40, -50, -50, -40, -40, -30],
        [-30, -40, -40, -50, -50, -40, -40, -30],
    ];

    pub const KING_TABLE_END: [[i32; 8]; 8] = [
        [-50, -30, -30, -30, -30, -30, -30, -50],
        [-30, -30, 0, 0, 0, 0, -30, -30],
        [-30, -10, 20, 30, 30, 20, -10, -30],
        [-30, -10, 30, 40, 40, 30, -10, -30],
        [-30, -10, 30, 40, 40, 30, -10, -30],
        [-30, -10, 20, 30, 30, 20, -10, -30],
        [-30, -20, -10, 0, 0, -10, -20, -30],
        [-50, -40, -30, -20, -20, -30, -40, -50],
    ];

    pub const DIAGONAL_RAY: [[[u64; 8]; 8]; 4] = [
        // Top Left Diagonal Ray
        [
            [0, 0, 0, 0, 0, 0, 0, 0],
            [
                0, 9223372036854775808, 4611686018427387904, 2305843009213693952,
                1152921504606846976, 576460752303423488, 288230376151711744, 144115188075855872,
            ],
            [
                0, 36028797018963968, 9241386435364257792, 4620693217682128896,
                2310346608841064448, 1155173304420532224, 577586652210266112, 288793326105133056,
            ],
            [
                0, 140737488355328, 36099165763141632, 9241421619736346624, 4620710809868173312, 2310355404934086656,
                1155177702467043328, 577588851233521664,
            ],
            [
                0, 549755813888, 141012366262272, 36099303202095104, 9241421688455823360, 4620710844227911680,
                2310355422113955840, 1155177711056977920,
            ],
            [
                0, 2147483648, 550829555712, 141012903133184, 36099303470530560, 9241421688590041088,
                4620710844295020544, 2310355422147510272,
            ],
            [
                0, 8388608, 2151677952, 550831652864, 141012904181760, 36099303471054848,
                9241421688590303232, 4620710844295151616,
            ],
            [
                0, 32768, 8404992, 2151686144, 550831656960, 141012904183808, 36099303471055872, 9241421688590303744,
            ],
        ],
        // Top Right Diagonal Ray
        [
            [0, 0, 0, 0, 0, 0, 0, 0],
            [
                4611686018427387904, 2305843009213693952, 1152921504606846976, 576460752303423488,
                288230376151711744, 144115188075855872, 72057594037927936, 0,
            ],
            [
                2323857407723175936, 1161928703861587968, 580964351930793984, 290482175965396992,
                145241087982698496, 72620543991349248, 281474976710656, 0,
            ],
            [
                1161999072605765632, 580999536302882816, 290499768151441408, 145249884075720704,
                72624942037860352, 283673999966208, 1099511627776, 0,
            ],
            [
                580999811180789760, 290499905590394880, 145249952795197440, 72624976397598720,
                283691179835392, 1108101562368, 4294967296, 0,
            ],
            [
                290499906664136704, 145249953332068352, 72624976666034176, 283691314053120,
                1108168671232, 4328521728, 16777216, 0,
            ],
            [
                145249953336262656, 72624976668131328, 283691315101696, 1108169195520, 4328783872, 16908288,
                65536, 0,
            ],
            [
                72624976668147712, 283691315109888, 1108169199616, 4328785920, 16909312, 66048,
                256, 0,
            ],
        ],
        // Bottom Right Diagonal Ray
        [
            [
                18049651735527937, 9024825867763968, 4512412933881856, 2256206466908160,
                1128103225065472, 564049465049088, 281474976710656, 0,
            ],
            [
                70506452091906, 35253226045953, 17626613022976, 8813306511360, 4406653222912, 2203318222848,
                1099511627776, 0,
            ],
            [
                275415828484, 137707914242, 68853957121, 34426978560, 17213489152, 8606711808,
                4294967296, 0,
            ],
            [1075843080, 537921540, 268960770, 134480385, 67240192, 33619968, 16777216, 0],
            [4202512, 2101256, 1050628, 525314, 262657, 131328, 65536, 0],
            [16416, 8208, 4104, 2052, 1026, 513, 256, 0],
            [64, 32, 16, 8, 4, 2, 1, 0],
            [0, 0, 0, 0, 0, 0, 0, 0],
        ],
        // Bottom Left Diagonal Ray
        [
            [
                0, 36028797018963968, 18155135997837312, 9078117754732544, 4539061024849920, 2269530520813568,
                1134765260439552, 567382630219904,
            ],
            [
                0, 140737488355328, 70918499991552, 35461397479424, 17730707128320, 8865353596928,
                4432676798592, 2216338399296,
            ],
            [
                0, 549755813888, 277025390592, 138521083904, 69260574720, 34630287488, 17315143744, 8657571872,
            ],
            [0, 2147483648, 1082130432, 541097984, 270549120, 135274560, 67637280, 33818640],
            [0, 8388608, 4227072, 2113664, 1056832, 528416, 264208, 132104],
            [0, 32768, 16512, 8256, 4128, 2064, 1032, 516],
            [0, 128, 64, 32, 16, 8, 4, 2],
            [0, 0, 0, 0, 0, 0, 0, 0],
        ],
    ];

    pub const STRAIGHT_RAY: [[[u64; 8]; 8]; 4] = [
        // Top Ray
        [
            [0, 0, 0, 0, 0, 0, 0, 0],
            [
                9223372036854775808, 4611686018427387904, 2305843009213693952, 1152921504606846976,
                576460752303423488, 288230376151711744, 144115188075855872, 72057594037927936,
            ],
            [
                9259400833873739776, 4629700416936869888, 2314850208468434944, 1157425104234217472,
                578712552117108736, 289356276058554368, 144678138029277184, 72339069014638592,
            ],
            [
                9259541571362095104, 4629770785681047552, 2314885392840523776, 1157442696420261888,
                578721348210130944, 289360674105065472, 144680337052532736, 72340168526266368,
            ],
            [
                9259542121117908992, 4629771060558954496, 2314885530279477248, 1157442765139738624,
                578721382569869312, 289360691284934656, 144680345642467328, 72340172821233664,
            ],
            [
                9259542123265392640, 4629771061632696320, 2314885530816348160, 1157442765408174080,
                578721382704087040, 289360691352043520, 144680345676021760, 72340172838010880,
            ],
            [
                9259542123273781248, 4629771061636890624, 2314885530818445312, 1157442765409222656,
                578721382704611328, 289360691352305664, 144680345676152832, 72340172838076416,
            ],
            [
                9259542123273814016, 4629771061636907008, 2314885530818453504, 1157442765409226752,
                578721382704613376, 289360691352306688, 144680345676153344, 72340172838076672,
            ],
        ],
        // Right Ray
        [
            [
                9151314442816847872, 4539628424389459968, 2233785415175766016, 1080863910568919040,
                504403158265495552, 216172782113783808, 72057594037927936, 0,
            ],
            [
                35747322042253312, 17732923532771328, 8725724278030336, 4222124650659840,
                1970324836974592, 844424930131968, 281474976710656, 0,
            ],
            [
                139637976727552, 69269232549888, 34084860461056, 16492674416640, 7696581394432, 3298534883328,
                1099511627776, 0,
            ],
            [
                545460846592, 270582939648, 133143986176, 64424509440, 30064771072, 12884901888,
                4294967296, 0,
            ],
            [2130706432, 1056964608, 520093696, 251658240, 117440512, 50331648, 16777216, 0],
            [8323072, 4128768, 2031616, 983040, 458752, 196608, 65536, 0],
            [32512, 16128, 7936, 3840, 1792, 768, 256, 0],
            [127, 63, 31, 15, 7, 3, 1, 0],
        ],
        // Bottom Ray
        [
            [
                36170086419038336, 18085043209519168, 9042521604759584, 4521260802379792,
                2260630401189896, 1130315200594948, 565157600297474, 282578800148737,
            ],
            [
                141289400074368, 70644700037184, 35322350018592, 17661175009296, 8830587504648, 4415293752324,
                2207646876162, 1103823438081,
            ],
            [
                551911719040, 275955859520, 137977929760, 68988964880, 34494482440, 17247241220,
                8623620610, 4311810305,
            ],
            [2155905152, 1077952576, 538976288, 269488144, 134744072, 67372036, 33686018, 16843009],
            [8421504, 4210752, 2105376, 1052688, 526344, 263172, 131586, 65793],
            [32896, 16448, 8224, 4112, 2056, 1028, 514, 257],
            [128, 64, 32, 16, 8, 4, 2, 1],
            [0, 0, 0, 0, 0, 0, 0, 0],
        ],
        // Left Ray
        [
            [
                0, 9223372036854775808, 13835058055282163712, 16140901064495857664,
                17293822569102704640, 17870283321406128128, 18158513697557839872, 18302628885633695744,
            ],
            [
                0, 36028797018963968, 54043195528445952, 63050394783186944, 67553994410557440, 69805794224242688,
                70931694131085312, 71494644084506624,
            ],
            [
                0, 140737488355328, 211106232532992, 246290604621824, 263882790666240, 272678883688448,
                277076930199552, 279275953455104,
            ],
            [
                0, 549755813888, 824633720832, 962072674304, 1030792151040, 1065151889408,
                1082331758592, 1090921693184,
            ],
            [0, 2147483648, 3221225472, 3758096384, 4026531840, 4160749568, 4227858432, 4261412864],
            [0, 8388608, 12582912, 14680064, 15728640, 16252928, 16515072, 16646144],
            [0, 32768, 49152, 57344, 61440, 63488, 64512, 65024],
            [0, 128, 192, 224, 240, 248, 252, 254],
        ],
    ];

    pub const KNIGHT_MAP: [[u64; 8]; 8] = [
        [
            9077567998918656, 4679521487814656, 38368557762871296, 19184278881435648,
            9592139440717824, 4796069720358912, 2257297371824128, 1128098930098176,
        ],
        [
            2305878468463689728, 1152939783987658752, 9799982666336960512, 4899991333168480256,
            2449995666584240128, 1224997833292120064, 576469569871282176, 288234782788157440,
        ],
        [
            4620693356194824192, 11533718717099671552, 5802888705324613632, 2901444352662306816,
            1450722176331153408, 725361088165576704, 362539804446949376, 145241105196122112,
        ],
        [
            18049583422636032, 45053588738670592, 22667534005174272, 11333767002587136,
            5666883501293568, 2833441750646784, 1416171111120896, 567348067172352,
        ],
        [
            70506185244672, 175990581010432, 88545054707712, 44272527353856, 22136263676928, 11068131838464,
            5531918402816, 2216203387392,
        ],
        [
            275414786112, 687463207072, 345879119952, 172939559976, 86469779988, 43234889994,
            21609056261, 8657044482,
        ],
        [1075839008, 2685403152, 1351090312, 675545156, 337772578, 168886289, 84410376, 33816580],
        [4202496, 10489856, 5277696, 2638848, 1319424, 659712, 329728, 132096],
    ];

    pub const KING_MAP: [[u64; 8]; 8] = [
        [
            4665729213955833856, 11592265440851656704, 5796132720425828352, 2898066360212914176,
            1449033180106457088, 724516590053228544, 362258295026614272, 144959613005987840,
        ],
        [
            13853283560024178688, 16186183351374184448, 8093091675687092224, 4046545837843546112,
            2023272918921773056, 1011636459460886528, 505818229730443264, 216739030602088448,
        ],
        [
            54114388906344448, 63227278716305408, 31613639358152704, 15806819679076352,
            7903409839538176, 3951704919769088, 1975852459884544, 846636838289408,
        ],
        [
            211384331665408, 246981557485568, 123490778742784, 61745389371392, 30872694685696, 15436347342848,
            7718173671424, 3307175149568,
        ],
        [
            825720045568, 964771708928, 482385854464, 241192927232, 120596463616, 60298231808,
            30149115904, 12918652928,
        ],
        [3225468928, 3768639488, 1884319744, 942159872, 471079936, 235539968, 117769984, 50463488],
        [12599488, 14721248, 7360624, 3680312, 1840156, 920078, 460039, 197123],
        [49216, 57504, 28752, 14376, 7188, 3594, 1797, 770],
    ];

    pub const PAWN_MAP: [[[u64; 8]; 8]; 2] = [
        // White Pawn
        [
            [
                18014398509481984, 45035996273704960, 22517998136852480, 11258999068426240,
                5629499534213120, 2814749767106560, 1407374883553280, 562949953421312,
            ],
            [
                70368744177664, 175921860444160, 87960930222080, 43980465111040, 21990232555520, 10995116277760,
                5497558138880, 2199023255552,
            ],
            [
                274877906944, 687194767360, 343597383680, 171798691840, 85899345920, 42949672960,
                21474836480, 8589934592,
            ],
            [
                1073741824, 2684354560, 1342177280, 671088640, 335544320, 167772160, 83886080, 33554432,
            ],
            [4194304, 10485760, 5242880, 2621440, 1310720, 655360, 327680, 131072],
            [16384, 40960, 20480, 10240, 5120, 2560, 1280, 512],
            [64, 160, 80, 40, 20, 10, 5, 2],
            [0, 0, 0, 0, 0, 0, 0, 0],
        ],
        // Black Pawn
        [
            [0, 0, 0, 0, 0, 0, 0, 0],
            [
                4611686018427387904, 11529215046068469760, 5764607523034234880, 2882303761517117440,
                1441151880758558720, 720575940379279360, 360287970189639680, 144115188075855872,
            ],
            [
                18014398509481984, 45035996273704960, 22517998136852480, 11258999068426240,
                5629499534213120, 2814749767106560, 1407374883553280, 562949953421312,
            ],
            [
                70368744177664, 175921860444160, 87960930222080, 43980465111040, 21990232555520, 10995116277760,
                5497558138880, 2199023255552,
            ],
            [
                274877906944, 687194767360, 343597383680, 171798691840, 85899345920, 42949672960,
                21474836480, 8589934592,
            ],
            [
                1073741824, 2684354560, 1342177280, 671088640, 335544320, 167772160, 83886080, 33554432,
            ],
            [4194304, 10485760, 5242880, 2621440, 1310720, 655360, 327680, 131072],
            [16384, 40960, 20480, 10240, 5120, 2560, 1280, 512],
        ],
    ];
}
